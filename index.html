<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unified Finder Hub</title>

  <meta name="creator" content="Created by Abdelrahman Khater">

  <!-- Favicons -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0f1b33;
      --border: rgba(255,255,255,0.14);
      --text:#e5e7eb;
      --muted:#a7b0c0;

      /* fixed header height (your .top-credit is ~42px) */
      --top-credit-h: 42px;
      --shell-pad: 18px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(96,165,250,0.25), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(52,211,153,0.20), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100dvh;

      /* matches the fixed top bar + iOS safe area */
      padding-top: calc(var(--top-credit-h) + env(safe-area-inset-top));
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding: var(--shell-pad);
    }

    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border-radius:16px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      flex-wrap: wrap;
    }

    /* scope headings so you don’t accidentally style iframe content */
    .topbar h1{ margin:0; font-size:18px; }
    .sub{ margin:2px 0 0; color:var(--muted); font-size:12px; }

    .top-credit{
      position:fixed;
      top:0; left:0; right:0;
      z-index:99999;
      height: var(--top-credit-h);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:8px 12px;
      font-size:12px;
      font-weight:700;
      color:var(--muted);
      background: rgba(11,18,32,0.92);
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      gap:10px;
      flex-wrap:wrap;
    }

    .top-credit b{ color:var(--text); }
    .top-credit a{
      color:var(--text);
      text-decoration:none;
      border-bottom:1px dashed rgba(255,255,255,0.28);
    }
    .top-credit a:hover{ border-bottom-color: rgba(255,255,255,0.55); }

    .tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .tabbtn{
      border:1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      user-select:none;
      white-space:nowrap;
    }
    .tabbtn:hover{ background: rgba(255,255,255,0.10); }
    .tabbtn.active{
      border-color: rgba(96,165,250,0.55);
      background: linear-gradient(135deg, rgba(96,165,250,0.18), rgba(52,211,153,0.12));
      box-shadow: 0 0 0 4px rgba(96,165,250,0.12);
    }

    .panel{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      background: rgba(255,255,255,0.04);
      box-shadow: 0 14px 40px rgba(0,0,0,0.30);
    }

    .hint{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .hint code{
      background: rgba(96,165,250,0.14);
      border:1px solid rgba(96,165,250,0.22);
      padding:2px 6px;
      border-radius:8px;
      color:var(--text);
    }

    .framehost{ position:relative; width:100%; }

    /* use 100dvh so mobile browser chrome doesn’t break sizing */
    .toolframe{
      width:100%;
      height: calc(100dvh - 210px);
      border:0;
      background:#fff;
      display:none;
    }
    .toolframe.active{ display:block; }

    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: #111827;
      color: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 12px 24px rgba(0,0,0,.18);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .18s ease, transform .18s ease;
      font-size: 12px;
      pointer-events:none;
      z-index: 9999;
      max-width: min(520px, calc(100vw - 32px));
      line-height:1.45;
    }
    .toast.show{ opacity:1; transform: translateY(0); }

    .brand{ display:flex; align-items:center; gap:14px; }
    .hub-logo{
      height:34px;
      max-width:220px;
      object-fit:contain;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
    }
    @media (max-width:900px){
      .hub-logo{ height:28px; max-width:180px; }
      .toolframe{ height: calc(100dvh - 240px); }
    }
  </style>

  <!-- Optional theme files you already referenced -->
  <script>
    (function(){
      try{
        var t = localStorage.getItem('dispatchhub-theme');
        if(t === 'light' || t === 'dark'){
          document.documentElement.setAttribute('data-theme', t);
        }
      }catch(e){}
    })();
  </script>
  <link rel="stylesheet" href="assets/theme.css" />
  <link rel="stylesheet" href="assets/glass.css" />
  <script defer src="assets/theme.js"></script>
  <script defer src="assets/glass.js"></script>
</head>

<body>
  <div class="top-credit" style="color:#ffb56b;">
    Created by <b>Acuative</b> — for help contact <b>Abd L Rahman Khater</b>
    <a href="mailto:akhater@acuative.com" style="color:#ffb56b; text-decoration:none;">
      akhater@acuative.com
    </a>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img class="hub-logo" src="assets/acuative_logo.png" alt="Acuative" />
        <div>
          <h1>Unified Finder Hub</h1>
          <div class="sub">All-in-one hub for dispatch tools</div>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="Tools">
        <button class="tabbtn active" data-key="Contractors (B–J)" role="tab">Contractors (B–J)</button>
        <button class="tabbtn" data-key="On-Call Lookup" role="tab">On-Call Lookup</button>
        <button class="tabbtn" data-key="Flex Tech Finder (Tier 2)" role="tab">Flex Tech Finder</button>
        <button class="tabbtn" data-key="Canada Dispatch W2" role="tab">Canada Dispatch W2</button>
        <button class="tabbtn" data-key="International Suppliers" role="tab">International Suppliers</button>
      </div>
    </div>

    <div class="panel">
      <div class="hint">
        <div id="hintText">Loaded: <b>Contractors (B–J)</b></div>
        <div>Clipboard: if copy buttons inside tabs fail, hub will copy for them.</div>
      </div>
      <div id="frameHost" class="framehost" aria-live="polite"></div>
    </div>
  </div>

  <div class="toast" id="hubToast"></div>

  <script>
    // ========= YOUR PAGES MAP =========
    // Supported formats:
    // 1) Base64-encoded HTML string
    // 2) "__FILE__:relative/path/index.html"
    // 3) "https://example.com"
    // 4) Raw HTML (less common)

    const PAGES = {
      "Contractors (B–J)": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiLz4KICA8dGl0bGU+Q29udHJhY3RvciBieSBTdGF0ZSAoQuKAk0opPC90aXRsZT4KICA8c3R5bGU+CiAgICAvKiBQdXJwbGUgKyBXaGl0ZSArIEJsdWUgdGhlbWUgKi8KICAgIDpyb290IHsKICAgICAgLS1iZzE6ICNmNmYxZmY7CiAgICAgIC0tYmcyOiAjZWVmNGZmOwogICAgICAtLWluazogIzExMTgyNzsKICAgICAgLS1tdXRlZDogIzRiNTU2MzsKICAgICAgLS1jYXJkOiByZ2JhKDI1NSwyNTUsMjU1LDAuODgpOwogICAgICAtLXA6ICNhODU1Zjc7CiAgICAgIC0tYjogIzNiODJmNjsKICAgIH0KCiAgICBib2R5IHsKICAgICAgZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICBtYXJnaW46IDA7CiAgICAgIHBhZGRpbmc6IDI0cHg7CiAgICAgIGNvbG9yOiB2YXIoLS1pbmspOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCB2YXIoLS1iZzEpLCB2YXIoLS1iZzIpKTsKICAgIH0K    <!-- (… keep your original base64 exactly as-is …) -->Cg==",

      "On-Call Lookup": "__FILE__:oncall_webapp_v8/index.html",

      "Flex Tech Finder (Tier 2)": "__FILE__:flex_webapp_v8/index.html",

      "Canada Dispatch W2": "__FILE__:canada_dispatch_w2/index.html",

      // IMPORTANT: your base64 for this tab was cut in the chat.
      // Paste the FULL base64 string from your real file here:
      "International Suppliers": "__PASTE_BASE64_HERE__"
    };

    // ========= UI HELPERS =========
    const host = document.getElementById('frameHost');
    const hintText = document.getElementById('hintText');
    const toastEl = document.getElementById('hubToast');

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=>toastEl.classList.remove('show'), 2200);
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        // fallback
        try{
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position='fixed';
          ta.style.left='-9999px';
          ta.style.top='-9999px';
          document.body.appendChild(ta);
          ta.select();
          ta.setSelectionRange(0, ta.value.length);
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return ok;
        }catch(e2){
          return false;
        }
      }
    }

    function isProbablyBase64(s){
      if(!s) return false;
      const t = (s + '').trim();
      if(t.length < 80) return false;
      if(!/^[A-Za-z0-9+/=\s]+$/.test(t)) return false;
      // common base64 prefix for "<!DOCTYPE" => "PCFET0NU"
      return t.startsWith('PCF') || t.startsWith('PGh0') || t.startsWith('PGRv');
    }

    function decodeBase64(b64){
      const clean = b64.replace(/\s+/g,'');
      return atob(clean);
    }

    function ensureFrame(key){
      let fr = host.querySelector(`iframe[data-key="${CSS.escape(key)}"]`);
      if(fr) return fr;

      fr = document.createElement('iframe');
      fr.className = 'toolframe';
      fr.setAttribute('data-key', key);

      // allow scripts/forms in embedded tools
      fr.setAttribute('sandbox', [
        'allow-scripts',
        'allow-forms',
        'allow-popups',
        'allow-downloads',
        'allow-modals',
        'allow-pointer-lock',
        'allow-same-origin' // keep if your tools need localStorage or same-origin features
      ].join(' '));

      host.appendChild(fr);
      return fr;
    }

    function loadIntoFrame(key){
      const val = PAGES[key];
      const fr = ensureFrame(key);

      if(!val){
        fr.removeAttribute('src');
        fr.srcdoc = `<html><body style="font-family:Arial;padding:16px">
          <h3>Missing page mapping</h3>
          <p>No entry found for <b>${key}</b> in PAGES.</p>
        </body></html>`;
        return;
      }

      if(typeof val === 'string' && val.startsWith('__FILE__:')){
        const path = val.replace('__FILE__:', '').trim();
        fr.removeAttribute('srcdoc');
        fr.src = path;
        return;
      }

      if(typeof val === 'string' && (/^https?:\/\//i).test(val.trim())){
        fr.removeAttribute('srcdoc');
        fr.src = val.trim();
        return;
      }

      if(typeof val === 'string' && isProbablyBase64(val)){
        try{
          const html = decodeBase64(val);
          fr.removeAttribute('src');
          fr.srcdoc = html;
          return;
        }catch(e){
          fr.removeAttribute('src');
          fr.srcdoc = `<html><body style="font-family:Arial;padding:16px">
            <h3>Base64 decode failed</h3>
            <p>Tab: <b>${key}</b></p>
            <p style="color:#b91c1c">Make sure the base64 string is complete (not truncated).</p>
          </body></html>`;
          return;
        }
      }

      // treat as raw HTML
      fr.removeAttribute('src');
      fr.srcdoc = String(val);
    }

    function setActiveTab(key){
      // buttons
      document.querySelectorAll('.tabbtn').forEach(b=>{
        b.classList.toggle('active', b.dataset.key === key);
      });

      // frames
      const frames = host.querySelectorAll('.toolframe');
      frames.forEach(fr => fr.classList.toggle('active', fr.getAttribute('data-key') === key));

      hintText.innerHTML = `Loaded: <b>${key}</b>`;
    }

    // ========= LISTEN FOR COPY EVENTS FROM IFRAMES =========
    // If a child page calls: parent.postMessage({type:"COPY", text:"..."}, "*")
    // this hub will copy it.
    window.addEventListener('message', async (ev) => {
      const data = ev && ev.data;
      if(!data || typeof data !== 'object') return;

      if(data.type === 'COPY' && typeof data.text === 'string'){
        const ok = await copyToClipboard(data.text);
        toast(ok ? 'Copied to clipboard ✅' : 'Copy failed ❌');
      }
    });

    // ========= INIT =========
    function init(){
      // create/load all frames once (so switching is instant)
      Object.keys(PAGES).forEach(k => loadIntoFrame(k));

      // activate default tab (first button)
      const first = document.querySelector('.tabbtn')?.dataset?.key || Object.keys(PAGES)[0];
      setActiveTab(first);

      // tab clicks
      document.querySelectorAll('.tabbtn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const key = btn.dataset.key;
          // if frame hasn't been loaded (rare), load now
          loadIntoFrame(key);
          setActiveTab(key);
        });
      });
    }

    init();
  </script>
</body>
</html>
